{"themeConfig":{"themeName":"notes","postPageSize":10,"archivesPageSize":50,"siteName":"ç‹å®‰çªçš„æ•°æ®åˆ†æé¡¹ç›®","siteDescription":"åˆçº§DAï¼Œè¯·å¤šå¤šæŒ‡æ•™ğŸ˜†ğŸ˜†","footerInfo":"","showFeatureImage":true,"domain":"https://Angie-DA.github.io","postUrlFormat":"SHORT_ID","tagUrlFormat":"SHORT_ID","dateFormat":"YYYY-MM-DD","feedFullText":false,"feedCount":10,"archivesPath":"archives","postPath":"","tagPath":""},"posts":[{"content":"é¡¹ç›®èƒŒæ™¯ ä»¥æ·˜å®appå¹³å°ä¸ºæ•°æ®é›†ï¼Œé€šè¿‡è¡Œä¸šçš„æŒ‡æ ‡å¯¹æ·˜å®ç”¨æˆ·è¡Œä¸ºè¿›è¡Œåˆ†æï¼Œä»è€Œæ¢ç´¢æ·˜å®ç”¨æˆ·çš„è¡Œä¸ºæ¨¡å¼ï¼Œå…·ä½“æŒ‡æ ‡åŒ…æ‹¬ï¼šæ—¥PVå’Œæ—¥UVåˆ†æï¼Œä»˜è´¹ç‡åˆ†æï¼Œå¤è´­è¡Œä¸ºåˆ†æï¼Œæ¼æ–—æµå¤±åˆ†æå’Œç”¨æˆ·ä»·å€¼RFMåˆ†æã€‚ æ•°æ®ä»‹ç» åˆ—åç§° è¯´æ˜ ç”¨æˆ·ID æ•´æ•°ç±»å‹ï¼Œåºåˆ—åŒ–åçš„ç”¨æˆ·ID å•†å“ID æ•´æ•°ç±»å‹ï¼Œåºåˆ—åŒ–åçš„å•†å“ID å•†å“ç±»ç›®ID æ•´æ•°ç±»å‹ï¼Œåºåˆ—åŒ–åçš„å•†å“æ‰€å±ç±»ç›®ID è¡Œä¸ºç±»å‹ å­—ç¬¦ä¸²ï¼Œæšä¸¾ç±»å‹ï¼ŒåŒ…æ‹¬('pv', 'buy', 'cart', 'fav') æ—¶é—´æˆ³ è¡Œä¸ºå‘ç”Ÿçš„æ—¶é—´æˆ³ è¡Œä¸ºç±»å‹ è¯´æ˜ pv å•†å“è¯¦æƒ…é¡µpvï¼Œç­‰ä»·äºç‚¹å‡» buy å•†å“è´­ä¹° cart å°†å•†å“åŠ å…¥è´­ç‰©è½¦ fav æ”¶è—å•†å“ åˆ†æç›®æ ‡ 1.ç”¨æˆ·è¡Œä¸ºåˆ†æ/ç”¨æˆ·åˆ†ç±»/æ¼æ–—åˆ†æï¼› 2.ç”¨æˆ·æµå¤±åˆ†æ/ç”¨æˆ·å¤è´­åˆ†æ 1 æ•°æ®è¯»å– import numpy as np import pandas as pd import matplotlib.pyplot as plt import seaborn as sns import json from pyecharts.globals import CurrentConfig, NotebookType from pyecharts import options as opts from pyecharts.charts import Line from pyecharts.charts import * from pyecharts.globals import ThemeType from pyecharts.charts import Bar from pyecharts.charts import Funnel # æ•°æ®é‡è¿‡å¤§è¶…è¿‡1000wï¼Œåˆ†ææ—¶æˆªå–å‰100wè¡Œ columns=[&quot;userid&quot;, 'itemid', 'categoryid', 'type', 'timestamp'] data = pd.read_csv('E:/UserBehavior.csv', engine='python', encoding='utf-8', names=columns, chunksize=1000000, iterator=True) plt.rcParams['font.sans-serif'] = 'SimHei' dataframe = data.get_chunk(1000000) 1.1 æŸ¥çœ‹æ•°æ®çš„åŸºæœ¬ä¿¡æ¯ dataframe.info() 2 æ•°æ®æ¸…æ´— dataframe.isnull().sum() 2.1 æŸ¥çœ‹æ•°æ®æ²¡æœ‰ç©ºå€¼çš„æ•°æ®çš„ä¸ªæ•° dataframe.nunique() 2.2 æŸ¥çœ‹æ•°æ®çš„å‰næ¡ dataframe.head(n=11) 2.3 è½¬æ¢ç±»å‹ã€æˆªå–æ•°æ®ã€é‡æ–°æ’åˆ— # åˆ é™¤é‡å¤å€¼ï¼Œç»“æœä¸€æ ·æ•°æ®æ— é‡å¤æœ‰æ•ˆæ•°æ® dataframe.drop_duplicates(subset=['userid','itemid','type','timestamp'],keep='first',inplace=True) dataframe.nunique() # åˆ é™¤é‡å¤å€¼ï¼Œç»“æœä¸€æ ·æ•°æ®æ— é‡å¤æœ‰æ•ˆæ•°æ® dataframe.drop_duplicates(subset=['userid','itemid','type','timestamp'],keep='first',inplace=True) dataframe.nunique() # å°†æ—¶é—´æˆ³è½¬ä¸ºæ—¥æœŸï¼Œä»åŸæ•°æ®çš„int64è½¬åŒ–ä¸ºæ—¥æœŸç±»å‹ import datetime # to_datetimeçš„é»˜è®¤æ—¶åŒºä¸æ˜¯ä¸­å›½éœ€è¦æ”¹æˆåŒ—äº¬æ—¶é—´+8h dataframe['time'] = pd.to_datetime(dataframe['timestamp'],unit='s')+datetime.timedelta(hours = 8) dataframe.head(n=5) dataframe.info() # åªæˆªå–2017.11.25-2017.12.3æœŸé—´çš„æ•°æ® startTime = datetime.datetime.strptime(&quot;2017-11-25 00:00:00&quot;,&quot;%Y-%m-%d %H:%M:%S&quot;) endTime = datetime.datetime.strptime(&quot;2017-12-3 23:59:59&quot;,&quot;%Y-%m-%d %H:%M:%S&quot;) # print(type(startTime)) dataframe = dataframe[(dataframe.time&gt;=startTime)&amp;(dataframe.time&lt;=endTime)] # åˆ é™¤åŸç´¢å¼•é‡æ–°æ’åˆ—æ–°çš„ç´¢å¼• dataframe = dataframe.reset_index(drop=True) # æ‹†åˆ†æ—¥æœŸå’Œå°æ—¶ dataframe['date']=dataframe.time.dt.date dataframe['hour']=dataframe.time.dt.hour #åˆ é™¤åŸæ•°æ®åˆ—çš„æ—¶é—´æˆ³å±æ€§ dataframe.drop('timestamp',inplace=True, axis=1) dataframe.head() # æè¿°æ€§ç»Ÿè®¡æ•°æ®ï¼Œç§‘å­¦è®¡æ•°æ³•è¡¨ç¤º dataframe.describe() 2.4 æ•°æ®æ¸…æ´—ç»“æœ print('æ•°æ®æ¸…æ´—åå…±æœ‰{}è¡Œè®°å½•ï¼Œ{}åˆ—å­—æ®µï¼Œå­—æ®µåˆ†åˆ«ä¸º{}'.format(dataframe.shape[0],dataframe.shape[1],dataframe.columns.tolist())) 3 æ•°æ®åˆ†æ # æœ‰æ•ˆæ—¶é—´å†…æ€»ç”¨æˆ·æ•°é‡ï¼Œæœ‰æ“ä½œçš„å•†å“æ•°é‡åŠç±»ç›® # ç‹¬ç«‹è®¿å®¢æ•°UV total_unique_users = dataframe.userid.nunique() # æœ‰æ“ä½œçš„å•†å“ total_unique_itemid = dataframe.itemid.nunique() # æœ‰æ“ä½œçš„å•†å“ç±»ç›® total_unique_categoryid = dataframe.categoryid.nunique() # ä»˜è´¹ç”¨æˆ·æ•° user_bought_count = dataframe[dataframe['type']=='buy'].userid.nunique() # éä»˜è´¹ç”¨æˆ·æ•° user_nobought_count = total_unique_users - user_bought_count 3.1 è¾“å‡ºå½“å‰æ•°æ®å„æ ç›®è®¡æ•° total={'UV':[total_unique_users],'å•†å“æ•°':[total_unique_itemid],'ç±»ç›®æ•°':[total_unique_categoryid],'ä»˜è´¹ç”¨æˆ·æ•°':[user_bought_count],'éä»˜è´¹ç”¨æˆ·æ•°':[user_nobought_count]} totalnew= pd.DataFrame(total,index = ['']) totalnew 3.2 ç”¨æˆ·å¤è´­ç‡ ç”¨æˆ·å¤è´­ç‡=è´­ä¹°2æ¬¡åŠä»¥ä¸Šç”¨æˆ·æ•°/æ€»è´­ä¹°ç”¨æˆ·æ•° groupby_userid = dataframe.groupby('userid') user_type = groupby_userid.type.value_counts().unstack() # ä½¿ç”¨unstackè¿›è¡Œä¸å †å æ“ä½œï¼Œåˆ—æ–¹å‘ä¸Šçš„ç´¢å¼•è½¬æˆè¡Œæ–¹å‘çš„ç´¢å¼• user_type.tail() 3.3 å¯è§†åŒ–å›¾è¡¨ # æå–æ•°æ® type_series = dataframe.type.value_counts() # æå–æ•°æ® type_series = dataframe.type.value_counts() 3.3.1 é¥¼å›¾-ç”¨æˆ·è¡Œä¸ºå æ¯” plt.figure(figsize = (5,5), dpi = 100) plt.pie(type_series, labels=type_series.index, autopct='%1.2f%%', pctdistance = 0.8, counterclock = False, wedgeprops = {'width':0.4}) plt.title('ç”¨æˆ·è¡Œä¸ºå æ¯”') plt.show() # plt.savefig('./ç”¨æˆ·è¡Œä¸ºå æ¯”.png') 3.3.2 åŠ¨æ€æ›²çº¿-æ¯æ—¥pvã€uv #æå–æ•°æ® pv_day = dataframe[dataframe.type =='pv'].groupby('date')['type'].count() uv_day = dataframe[dataframe.type =='pv'].drop_duplicates(['userid','date']).groupby('date')['userid'].count() #è½¬æ¢æˆå›¾è¡¨æ‰€éœ€çš„æ ¼å¼ #1ã€æ—¥æœŸï¼ˆlist.indexï¼‰ date = pv_day.index #2ã€pvã€uvï¼ˆlist.valuesï¼‰ pv = np.around(pv_day.values/10000,decimals=2) # uv = np.around(uv_day.values,decimals=2) uv=uv_day # åˆ¶ä½œæ›²çº¿å›¾è¡¨ x=list(date) y1=pv y2=uv pvuv_day_line = (Line(init_opts=opts.InitOpts(theme=ThemeType.DARK)) .add_xaxis(x) #xè½´æ•°æ®æº .add_yaxis('pv',#å›¾ä¾‹åå­— y1, #y1è½´æ•°æ®æº label_opts=opts.LabelOpts(is_show=False), #ä¸æ˜¾ç¤ºæ•°æ®æ ‡ç­¾ ) .add_yaxis('uv',#å›¾ä¾‹åå­— yaxis_index=1, #Yçš„åŒè½´1å·ç´¢å¼•ï¼ˆåŒºåˆ«äºy1è½´ï¼‰ y_axis=y2, #y2è½´æ•°æ®æº label_opts=opts.LabelOpts(is_show=False) #ä¸æ˜¾ç¤ºæ•°æ®æ ‡ç­¾ ) .extend_axis( #y2è½´è®¾ç½® yaxis=opts.AxisOpts( name='uv',#è½´åå­— min_=5000,#è½´èµ·ç‚¹å€¼ max_=15000, #è½´æœ€å¤§å€¼ interval=1000, #è½´åŒºé—´é—´éš” axislabel_opts=opts.LabelOpts(formatter=&quot;{value} äºº&quot;) #è½´æ•°æ®æ ‡ç­¾æ ¼å¼è®¾ç½® ) ) .set_global_opts( #å…¨å±€è®¾ç½® tooltip_opts=opts.TooltipOpts(is_show=True,trigger=&quot;axis&quot;,axis_pointer_type='cross'), #éšé¼ æ ‡ä½ç½®æ˜¾ç¤ºxyè½´çš„æ•°æ®ã€èšç„¦å½¢å¼(äº¤å‰) xaxis_opts=opts.AxisOpts(type_='category',axispointer_opts=opts.AxisPointerOpts(is_show=True,type_=&quot;shadow&quot;)),#éšé¼ æ ‡ä½ç½®å‡¸æ˜¾xè½´é•¿æ¡ã€å‡¸æ˜¾å½¢å¼ï¼ˆé˜´å½±ï¼‰ yaxis_opts=opts.AxisOpts(name='pv',axislabel_opts=opts.LabelOpts(formatter=&quot;{value} ä¸‡æ¬¡&quot;)),#y1è½´(é»˜è®¤è½´)åå­—ã€è½´æ•°æ®æ ‡ç­¾æ ¼å¼è®¾ç½® title_opts=opts.TitleOpts(title=&quot;æ¯æ—¥pvå’Œuv&quot;) #æ ‡é¢˜ ) ) pvuv_day_line.render_notebook() #å±•ç¤ºå›¾è¡¨ 3.3.3 æ¼æ–—å›¾-ç”¨æˆ·è¡Œä¸º ç¬¬ä¸€å±‚ï¼šç”¨æˆ·å…¨éƒ¨è¡Œä¸ºï¼ˆpvã€buyã€cartã€favï¼‰ ç¬¬äºŒå±‚ï¼šæ”¶è—/åŠ è´­è¡Œä¸ºï¼ˆcart/favï¼‰ ç¬¬ä¸‰å±‚ï¼šä»˜è´¹è¡Œä¸ºï¼ˆbuyï¼‰ ç¬¬ä¸€å±‚ï¼šç”¨æˆ·å…¨éƒ¨è¡Œä¸ºï¼ŒåŒä¸Š ç¬¬äºŒå±‚ï¼šä»…æµè§ˆå°±ä»˜è´¹è¡Œä¸ºï¼ˆbuyï¼‰ ç›®çš„ï¼šåˆ†æç”¨æˆ·è¡Œä¸ºçš„è½¬åŒ–ç‡ ç”¨æˆ·å„è¡Œä¸ºæ•°æ®è®¡ç®—æ–¹å¼ # æœ‰æ•ˆæ—¥æœŸ9å¤©å†…å„ä¸ªè¡Œä¸ºçš„æ“ä½œæ€»æ•°ï¼Œæ¯æ—¥å¹³å‡æ“ä½œæ•°ï¼Œæ¯æ—¥å¹³å‡æ“ä½œç”¨æˆ·æ•°è®°å½• type_df=pd.DataFrame([type_series,type_series/9,type_series/total_unique_users], index=['total','avg_day','avg_user']) # ä»˜è´¹ç”¨æˆ·è¡Œä¸ºè®°å½• type_df.loc['paying_user']=dataframe[dataframe['userid'].isin(dataframe[dataframe['type']=='buy']['userid'])].type.value_counts() type_df # æœ‰æ•ˆæ—¥æœŸ9å¤©å†…å„ä¸ªè¡Œä¸ºçš„æ“ä½œæ€»æ•°ï¼Œæ¯æ—¥å¹³å‡æ“ä½œæ•°ï¼Œæ¯æ—¥å¹³å‡æ“ä½œç”¨æˆ·æ•°è®°å½• type_df=pd.DataFrame([type_series,type_series/9,type_series/total_unique_users], index=['total','avg_day','avg_user']) â€‹ # ä»˜è´¹ç”¨æˆ·è¡Œä¸ºè®°å½• type_df.loc['paying_user']=dataframe[dataframe['userid'].isin(dataframe[dataframe['type']=='buy']['userid'])].type.value_counts() type_df # æå–typeç”¨æˆ·è¡Œä¸ºåˆ—ä¸­çš„æ¯ä¸€ä¸ªè¡Œä¸ºæ•°æ® pv_df = dataframe[dataframe['type']=='pv'] buy_df = dataframe[dataframe['type']=='buy'] cart_df = dataframe[dataframe['type']=='cart'] fav_df = dataframe[dataframe['type']=='fav'] # æ–¹å¼1 ç‚¹å‡»-&gt;åŠ è´­-&gt;è´­ä¹° pv_cart_df = pd.merge(left=pv_df,right=cart_df,how='inner',on=['userid','itemid','categoryid'],suffixes=('_pv','_cart')) cart_buy_df = pd.merge(left=cart_df,right=buy_df,how='inner',on=['userid','itemid','categoryid'],suffixes=('_cart','_buy')) count_users_pv_cart = pv_cart_df[pv_cart_df.time_pv &lt; pv_cart_df.time_cart].userid.nunique() count_users_cart_buy = cart_buy_df[cart_buy_df.time_cart &lt; cart_buy_df.time_buy].userid.nunique() # æ–¹å¼2 ç‚¹å‡»-&gt;æ”¶è—-&gt;è´­ä¹° pv_fav_df = pd.merge(left=pv_df,right=fav_df,how='inner',on=['userid','itemid','categoryid'],suffixes=('_pv','_fav')) fav_buy_df = pd.merge(left=fav_df,right=buy_df,how='inner',on=['userid','itemid','categoryid'],suffixes=('_fav','_buy')) count_user_pv_fav = pv_fav_df[pv_fav_df.time_pv &lt; pv_fav_df.time_fav].userid.nunique() count_user_fav_buy = fav_buy_df[fav_buy_df.time_fav &lt; fav_buy_df.time_buy].userid.nunique() # æ–¹å¼3 ç‚¹å‡»-&gt;è´­ä¹° pv_beh_buy_df = pd.merge(left=pv_df,right=buy_df,how='inner',on=['userid','itemid','categoryid'],suffixes=('_pv','_buy')) count_user_pv_beh_buy = pv_beh_buy_df[pv_beh_buy_df.time_pv &lt; pv_beh_buy_df.time_buy].userid.nunique() count_user_pv_buy = count_user_pv_beh_buy - count_users_cart_buy - count_user_fav_buy print(count_users_cart_buy) print(count_user_fav_buy) print(count_user_pv_buy) fav_cart_ratio = (count_user_pv_fav+count_users_pv_cart)/total_unique_users buy_beh_ratio=(count_user_fav_buy+count_users_cart_buy)/total_unique_users buy_ratio = count_user_pv_buy /total_unique_users # fav_buy=count_users_cart_buy/count_users_pv_cart # cart_buy=count_user_fav_buy/count_user_pv_fav print('æ”¶è—åŠ è´­ç”¨æˆ·è½¬åŒ–ç‡ä¸º:%.2f%%'%(fav_cart_ratio*100)) print('æ”¶è—åŠ è´­-&gt;è´­ä¹°ç”¨æˆ·è½¬åŒ–ç‡ä¸º:%.2f%%'%(buy_beh_ratio*100)) print('æµè§ˆç›´æ¥è´­ä¹°ç”¨æˆ·è½¬åŒ–ç‡ä¸º:%.2f%%'%(buy_ratio*100)) from pyecharts.charts import Funnel # æ¼æ–—å›¾datapair process_data_pair = [(&quot;ç‚¹å‡»é‡&quot;, total_unique_users), (&quot;æ”¶è—åŠ è´­é‡&quot;, count_user_pv_fav+count_users_pv_cart), (&quot;è´­ä¹°é‡&quot;, count_user_fav_buy+count_users_cart_buy)] ( Funnel(init_opts=opts.InitOpts(width='500px', height='400px')) .add(&quot;type&quot;, data_pair=process_data_pair, label_opts=opts.LabelOpts(position=&quot;top&quot;), gap=2, tooltip_opts=opts.TooltipOpts(is_show=True)) .set_global_opts(title_opts=opts.TitleOpts(title=&quot;ç”¨æˆ·è½¬åŒ–ç‡&quot;, subtitle=&quot;process æµè§ˆ-&gt;æ”¶è—/åŠ è´­-&gt;è´­ä¹°&quot;)) ).render_notebook() process_data_pair = [(&quot;ç‚¹å‡»é‡&quot;, total_unique_users), (&quot;è´­ä¹°é‡&quot;, count_user_pv_buy)] ( Funnel(init_opts=opts.InitOpts(width='500px', height='400px')) .add(&quot;type&quot;, data_pair=process_data_pair, label_opts=opts.LabelOpts(position=&quot;top&quot;), gap=2, tooltip_opts=opts.TooltipOpts(is_show=True)) .set_global_opts(title_opts=opts.TitleOpts(title=&quot;ç”¨æˆ·è½¬åŒ–ç‡&quot;, subtitle=&quot;process æµè§ˆ-&gt;è´­ä¹°&quot;)) ).render_notebook() 3.3.4 æŸ±çŠ¶å›¾-ç”¨æˆ·å¤è´­ç‡ repurchase_users = user_type[user_type['buy']&gt;=2].shape[0] # è´­ä¹°è®°å½•è¶…è¿‡1æ¬¡çš„ç”¨æˆ·æ•° repurchase_rate = repurchase_users/user_bought_count print(&quot;å¤è´­ç‡:{:.2f}%&quot;.format(repurchase_rate*100)) â€‹ # è¿›ä¸€æ­¥åˆ†æå¤è´­æ¬¡æ•° sns.histplot(user_type[user_type['buy']&gt;=2]['buy']-1,kde=False) plt.show() ç»“è®ºï¼šæ·˜å®ç”¨æˆ·å¤è´­ç‡è¾¾åˆ°66.01%ï¼Œä½†æ˜¯è¿›ä¸€æ­¥æŸ¥çœ‹ç”¨æˆ·å¤è´­æ¬¡æ•°ï¼Œå‘ç°ç»å¤§å¤šæ•°ç”¨æˆ·å¤è´­æ¬¡æ•°å¾ˆå°‘ï¼› ä¸ªäººæ€è€ƒï¼šåœ¨æ·˜å®ä¸‹æ²‰æ‰©å±•è·å–æ–°ç”¨æˆ·çš„åŒæ—¶ï¼Œä¿ƒè¿›è€ç”¨æˆ·å¤è´­æ¬¡æ•°å¢åŠ ï¼Œè¿›ä¸€æ­¥ç¨³å®šæé«˜å¤è´­ç‡åº”æ˜¯æ›´é‡è¦çš„ã€‚ 3.3.5 åŠ¨æ€æŸ±çŠ¶-ç”¨æˆ·é‡å˜åŒ–è¶‹åŠ¿ æ¯æ—¥çš„æ´»è·ƒç”¨æˆ·é‡åŸºæœ¬åœ¨71%å·¦å³ï¼Œè€Œæˆäº¤å®¢æˆ·åŸºæœ¬ç»´æŒåœ¨20% behavior_types=list(dict(dataframe['type'].value_counts()).keys()) behavior_types groupby_date = dataframe.groupby(by=dataframe.date) # æ ¹æ®æ—¥æœŸåˆ†ç»„ dates = sorted(list(dict(dataframe['date'].value_counts()).keys())) dates_df = pd.DataFrame(data=None, index=dates, columns=behavior_types) # åˆ›å»ºæŒ‰æ—¥æœŸåˆ†ç»„çš„æ•°æ®æ¡† for d in dates: dates_df.loc[d] = groupby_date.get_group(d).type.value_counts() # æŒ‰æ—¥æœŸå¡«å……æ•°æ®æ¡† # æ—¥æœŸè½¬æ¢ä¸ºæ˜ŸæœŸï¼Œdatetime.datetime.isoweekdayï¼ˆï¼‰è¿”å›çš„1-7ä»£è¡¨å‘¨ä¸€--å‘¨æ—¥ dates_df['weekday'] = [datetime.datetime.isoweekday(datetime.date(x.year,x.month,x.day)) for x in dates_df.index] dates_df dates_df['uv'] = [groupby_date.get_group(d).userid.nunique() for d in dates] # æ¯æ—¥ç‹¬ç«‹è®¿å®¢é‡ # è‡ªå®šä¹‰å½“å¤©ä½¿ç”¨æ·˜å®appè¿›è¡Œ5æ¬¡æ“ä½œï¼ˆä»»ä½•è¡Œä¸ºï¼‰çš„ç”¨æˆ·å°±æ˜¯æ´»è·ƒç”¨æˆ· active_user_standard = 3 # è‡ªå®šä¹‰æ´»è·ƒç”¨æˆ·æ“ä½œæ¬¡æ•° dates_df['dau'] = [(groupby_date.get_group(d).groupby(by='userid').size()&gt;active_user_standard).value_counts()[True] for d in dates] dates_df['au_rate'] = dates_df['dau']/dates_df['uv'] # æ´»è·ƒç”¨æˆ·æ¯”ä¾‹ dates_df['buyer'] = dataframe[dataframe['type']=='buy'].groupby(by=['date','userid']).size().count(level=0) dates_df['buyer_rate'] = dates_df['buyer']/dates_df['uv'] # ä»˜è´¹ç”¨æˆ·æ¯”ä¾‹ dates_df['ARPU'] = dates_df['buy']/dates_df['uv'] # äººå‡è´­ä¹°é‡=æ€»äº¤æ˜“é‡/å½“æ—¥UV dates_df['ARPPU'] = dates_df['buy']/dates_df['buyer'] # ä»˜è´¹ç”¨æˆ·äººå‡è´­ä¹°é‡ dates_df ( Line(init_opts=opts.InitOpts(width=&quot;800px&quot;, height=&quot;500px&quot;)) .add_xaxis(xaxis_data=dates_df.index) .add_yaxis(&quot;uv&quot;, y_axis=dates_df['uv'],is_symbol_show=False) .add_yaxis(&quot;dau&quot;,y_axis=dates_df['dau'],is_symbol_show=False) .add_yaxis(&quot;buyer&quot;,y_axis=dates_df['buyer'],is_symbol_show=False) .set_global_opts( title_opts=opts.TitleOpts(title=&quot;ç”¨æˆ·é‡å˜åŒ–è¶‹åŠ¿&quot;, subtitle=&quot;2017/11/25-2017/12/03æœŸé—´ç”¨æˆ·é‡å˜åŒ–è¶‹åŠ¿&quot;), tooltip_opts=opts.TooltipOpts(trigger='axis'), toolbox_opts=opts.ToolboxOpts(is_show=True), xaxis_opts=opts.AxisOpts(type_='category', boundary_gap=False)) ).render_notebook() 3.3.6 ç”¨æˆ·ä»·å€¼åˆ†æâ€”â€”RFMåˆ†æï¼ˆRecencyï¼ŒFrequencyï¼ŒMonetaryï¼‰Â¶ RFMæ¨¡å‹é€šè¿‡ä¸€ä¸ªå®¢æˆ·çš„è¿‘æœŸè´­ä¹°è¡Œä¸ºã€è´­ä¹°çš„æ€»ä½“é¢‘ç‡ä»¥åŠèŠ±äº†å¤šå°‘é’±3é¡¹æŒ‡æ ‡æ¥æè¿°è¯¥å®¢æˆ·çš„ä»·å€¼çŠ¶å†µã€‚ Rï¼ˆRecencyï¼‰ï¼šå®¢æˆ·æœ€è¿‘ä¸€æ¬¡äº¤æ˜“æ—¶é—´çš„é—´éš”ã€‚ Fï¼ˆFrequencyï¼‰ï¼šå®¢æˆ·åœ¨æœ€è¿‘ä¸€æ®µæ—¶é—´å†…äº¤æ˜“çš„æ¬¡æ•°ã€‚ Mï¼ˆMonetaryï¼‰ï¼šå®¢æˆ·åœ¨æœ€è¿‘ä¸€æ®µæ—¶é—´å†…äº¤æ˜“çš„é‡‘é¢ã€‚ æœ¬æ¬¡åˆ†ææ•°æ®é›†ä¸å«é‡‘é¢ï¼Œä»…ä»Rã€Fä¸¤ä¸ªç»´åº¦è¿›è¡Œåˆ†æ groupby_buy_userid = dataframe[dataframe['type']=='buy'].groupby(by='userid') RF = pd.DataFrame(index=groupby_buy_userid.groups.keys(), columns=['R', 'F']) RF['F'] = groupby_buy_userid.type.count() RF['last_buy_time'] = groupby_buy_userid.time.max() # å‡è®¾è·å–æ•°æ®é›†çš„ç¬¬äºŒå¤©è¿›è¡Œåˆ†æï¼Œæ‰€ä»¥é€‰æ‹©2017/12/04ä¸ºå¯¹ç…§æ—¥æœŸï¼Œä¿ç•™å¤©æ•° RF['R'] = (pd.to_datetime('2017-12-04')-RF['last_buy_time']).dt.days # æœ€è¿‘çš„ä¸€æ¬¡äº¤æ˜“è®°å½•è·ç¦»2017/12/04ä¸º0å¤© # å³12/03è´­ä¹°ç›¸å·®è¿˜ä¸åˆ°ä¸€å¤©ï¼Œæœ€è¿œçš„ä¸º9å¤©ï¼Œå¹³å‡ä¸º2.53å¤© # Råˆ’åˆ†4ä¸ªåŒºåŸŸ 0-1,2-3,4-6,7-9,åˆ†åˆ«å¾—åˆ†4ï¼Œ3ï¼Œ2ï¼Œ1 # äº¤æ˜“æ¬¡æ•°æœ€å°‘ä¸º1æ¬¡æœ€å¤šä¸º93æ¬¡,å¹³å‡3æ¬¡ # è¿™é‡Œçš„3æ¬¡åˆ†æ¯æ˜¯æ‰€æœ‰è´­ä¹°è¿‡å•†å“çš„ç”¨æˆ· # è€Œä¹‹å‰å¾—å‡ºçš„äººå‡è´­ä¹°æ¬¡æ•°2æ¬¡åˆ†æ¯æ˜¯æ‰€æœ‰ç”¨æˆ· # Fåˆ’åˆ†4ä¸ªåŒºåŸŸ 1,2,3,4+ï¼Œåˆ†åˆ«å¾—åˆ†1ï¼Œ2ï¼Œ3ï¼Œ4 RF[['R','F']].describe() def R_score(x): if 0 &lt;= x &lt;= 1: return 4 elif 2 &lt;= x &lt;= 3: return 3 elif 4 &lt;= x &lt;= 6: return 2 elif 7 &lt;= x &lt;= 9: return 1 else: return 0 def F_score(x): if x == 1: return 1 elif x == 2: return 2 elif x == 3: return 3 elif x &gt;= 4: return 4 else: return 0 # æ ¹æ®R,Fè¿›è¡Œè¯„åˆ† RF['R_score'] = RF.R.map(R_score) RF['F_score'] = RF.F.map(F_score) RF['R&gt;mean?']=(RF['R_score']&gt;RF['R_score'].mean())*1 RF['F&gt;mean?']=(RF['F_score']&gt;RF['F_score'].mean())*1 def user_classfication(tup): R_score, F_score = tup if R_score == 0 and F_score == 1: return &quot;é‡è¦ä¿æŒå®¢æˆ·&quot; elif R_score == 1 and F_score == 0: return &quot;é‡è¦å‘å±•å®¢æˆ·&quot; elif R_score == 1 and F_score == 1: return &quot;é‡è¦ä»·å€¼å®¢æˆ·&quot; elif R_score == 0 and F_score == 0: return &quot;é‡è¦æŒ½ç•™å®¢æˆ·&quot; else: return None RF['user_classification'] = RF[['R&gt;mean?','F&gt;mean?']].apply(user_classfication, axis=1) RF.head() ç»Ÿè®¡ç”¨æˆ·åˆ†ç±»æƒ…å†µ RF.user_classification.value_counts() ç”¨æˆ·åˆ†ç±»å æ¯” RF.user_classification.value_counts(1) ä¸ªäººæ€è€ƒï¼šæ ¹æ®RFMæ¨¡å‹å¯¹ç”¨æˆ·åˆ†ç±»åå‘ç°é‡è¦æŒ½ç•™å®¢æˆ·æ¯”ä¾‹æœ€é«˜ï¼Œå…¶æ¬¡æ˜¯é‡è¦ä»·å€¼ç”¨æˆ·ï¼Œæ·˜å®ä»…éœ€è¦é€‚å½“è¥é”€å¹¶æ¨å‡ºä¸€ç³»åˆ—çš„æ´»åŠ¨å°±èƒ½ç¨³å›ºéƒ¨åˆ†é‡è¦æŒ½ç•™å®¢æˆ·ï¼ŒåŒæ—¶ï¼Œéœ€è¦æé«˜ç¤¾ç¾¤ç®¡ç†çš„æ•ˆç‡ï¼Œå°†é‡è¦ä¿æŒå®¢æˆ·å’Œé‡è¦å‘å±•å®¢æˆ·è½¬å˜ä¸ºé‡è¦ä»·å€¼å®¢æˆ·ï¼Œå¯é‡‡å–å®šæœŸå‘é€æ–‡æ¡ˆã€èµ é€ä¼˜æƒ åˆ¸ç­‰æ–¹å¼ã€‚ ","tags":[],"title":"PythonåŸºäºæ·˜å®ç”¨æˆ·è¡Œä¸ºåˆ†æ","feature":"","link":"https://Angie-DA.github.io/sCLVmTSym/","stats":{"text":"15 min read","time":885000,"words":3166,"minutes":15},"date":"2022-03-13 19:21:55","dateFormat":"2022-03-13"}]}